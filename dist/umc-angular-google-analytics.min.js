/**
 * UMC Angular Google Analytics - Easy tracking for your AngularJS application
 * @version v0.4.0 - 2017-03-29
 * @link http://github.com/laffer1/angular-google-analytics
 * @author Julien Bouquillon <julien@revolunet.com>,Luke Palnau <lpalnau@umich.edu>,Lucas Holt <lholt@umich.edu>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
angular.module("umc-angular-google-analytics",[]).provider("Analytics",function(){"use strict";var a,b=!0,c="",d="analytics.js",e="$routeChangeSuccess";this.trackers=[],this.pixelCode=0,this._logs=[],this.setAccount=function(a){var b={code:a,name:"",trackEcommerce:!1,ecommerceLoaded:!1,trackDisplayfeatures:!1,displayfeaturesLoaded:!1,trackEnhancedEcommerce:!1,enhancedEcommerceLoaded:!1};return 0===this.trackers.length?this.trackers.push(b):this.trackers[0]=b,!0},this.trackPages=function(a){return b=a,!0},this.trackPrefix=function(a){return c=a,!0},this.setDomainName=function(b){return a=b,!0},this.setFilename=function(a){return d=a,!0},this.setPageEvent=function(a){return e=a,!0},this.trackEcommerce=function(a,b){if("undefined"==typeof b||null===b||""===b)return this.trackers[0].trackEcommerce=a,a;for(var c=1;c<this.trackers.length;c++)if(this.trackers[c].name===b)return this.trackers[c].trackEcommerce=a,a;return!1},this.trackEnhancedEcommerce=function(a,b){if("undefined"==typeof b||null===b||""===b)return this.trackers[0].trackEnhancedEcommerce=a,a;for(var c=1;c<this.trackers.length;c++)if(this.trackers[c].name===b)return this.trackers[c].trackEnhancedEcommerce=a,a;return!1},this.trackDisplayFeatures=function(a,b){if("undefined"==typeof b||null===b||""===b)return this.trackers[0].trackDisplayfeatures=a,a;for(var c=1;c<this.trackers.length;c++)if(this.trackers[c].name===b)return this.trackers[c].trackDisplayfeatures=a,a;return!1},this.addPixelTracker=function(a){this.pixelCode=a},this.addTracker=function(a,b){if("undefined"==typeof b||null===b||""===b)return void(this.trackers[0].code=a);for(var c=1;c<this.trackers.length;c++)if(this.trackers[c].name===b)return void(this.trackers[c].code=a);this.trackers.push({code:a,name:b,trackEcommerce:!1,ecommerceLoaded:!1,trackDisplayfeatures:!1,displayfeaturesLoaded:!1,trackEnhancedEcommerce:!1,enhancedEcommerceLoaded:!1})},this.getTrackers=function(){return this.trackers},this.$get=["$document","$rootScope","$location","$window",function(f,g,h,i){this._createScriptTag=function(){if(0!==this.trackers.length){i.GoogleAnalyticsObject="__gaTracker",angular.isUndefined(i.__gaTracker)&&(i.__gaTracker=function(){angular.isUndefined(i.__gaTracker.q)&&(i.__gaTracker.q=[]),i.__gaTracker.q.push(arguments)},i.__gaTracker.l=1*new Date);var c={};a&&(c.cookieDomain=a),i.__gaTracker("create",this.trackers[0].code);for(var e=1;e<this.trackers.length;e++)i.__gaTracker("create",this.trackers[e].code,{name:this.trackers[e].name});this._loadDisplayFeatures(),this._loadEcommerce(),this._loadEnhancedEcommerce(),b&&this._trackPage(h.path(),g.pageTitle),function(){if(!angular.isUndefined(f[0])){var a=f[0].createElement("script");a.type="text/javascript",a.async=!0,a.src="//www.google-analytics.com/"+d;var b=f[0].getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}}()}},this._createPixelScriptTag=function(){return angular.isUndefined(this)||""===this.pixelCode?void this._log("Pixel code missing"):"undefined"!=typeof i.fbq?void this._log("facebook pixel already initialized"):(function(){angular.isUndefined(f[0])||!function(a,b,c,d,e,f,g){a.fbq||(e=a.fbq=function(){e.callMethod?e.callMethod.apply(e,arguments):e.queue.push(arguments)},a._fbq||(a._fbq=e),e.push=e,e.loaded=!0,e.version="2.0",e.queue=[],f=b.createElement(c),f.async=!0,f.src=d,g=b.getElementsByTagName(c)[0],g.parentNode.insertBefore(f,g),i.pixel=e)}(window,document,"script","https://connect.facebook.net/en_US/fbevents.js")}(),void this._trackPixelPage())},this._trackPixelPage=function(){this._trackPixel("PageView")},this._trackPixel=function(a,b){angular.isUndefined(i.fbq)||(angular.isUndefined(i.pixelInit)&&(this._log("Initialize facebook pixel with code "+this.pixelCode),i.fbq("init",this.pixelCode),i.pixelInit=!0),angular.isUndefined(b)?i.fbq("track",a):i.fbq("track",a,b),this._log("pixel-"+a,b))},this._log=function(){this._logs.push(arguments)},this._loadDisplayFeatures=function(){this.trackers[0].trackDisplayfeatures&&!this.trackers[0].displayfeaturesLoaded&&(this.trackers[0].displayfeaturesLoaded=!0,i.__gaTracker("require","displayfeatures","displayfeatures.js"),this._log("loadGA","displayfeatures"));for(var a=1;a<this.trackers.length;a++)this.trackers[a].displayfeaturesLoaded||(this.trackers[a].displayfeaturesLoaded=!0,i.__gaTracker(this.trackers[a].name+".require","displayfeatures","displayfeatures.js"),this._log("loadGA","displayfeatures "+this.trackers[a].name))},this._loadEcommerce=function(){!this.trackers[0].trackEcommerce||this.trackers[0].ecommerceLoaded||this.trackers[0].trackEnhancedEcommerce||(this.trackers[0].ecommerceLoaded=!0,i.__gaTracker("require","ecommerce","ecommerce.js"),this._log("loadGA","ecommerce"));for(var a=1;a<this.trackers.length;a++)this.trackers[a].ecommerceLoaded||(this.trackers[a].ecommerceLoaded=!0,i.__gaTracker(this.trackers[a].name+".require","ecommerce","ecommerce.js"),this._log("loadGA","ecommerce "+this.trackers[a].name))},this._loadEnhancedEcommerce=function(){this.trackers[0].trackEnhancedEcommerce&&!this.trackers[0].enhancedEcommerceLoaded&&(this.trackers[0].enhancedEcommerceLoaded=!0,i.__gaTracker("require","ec","ec.js"),this._log("loadGA","ec"));for(var a=1;a<this.trackers.length;a++)this.trackers[a].enhancedEcommerceLoaded||(this.trackers[a].enhancedEcommerceLoaded=!0,i.__gaTracker(this.trackers[a].name+".require","ec","ec.js"),this._log("loadGA","ec "+this.trackers[a].name))},this._trackPage=function(a,b){if(!angular.isUndefined(i.__gaTracker)){this._loadDisplayFeatures(),angular.isUndefined(a)&&(a=h.path());var d=c+a;""!==d&&"/"!==d.charAt(0)&&(d="/"+d);var e={page:d};angular.isUndefined(b)&&angular.isDefined(g.pageTitle)&&(b=g.pageTitle),angular.isDefined(b)&&""!==b&&(e.title=b),i.__gaTracker("send","pageview",e);for(var f=1;f<this.trackers.length;f++)i.__gaTracker(this.trackers[f].name+".send","pageview",e);this._log("pageview",arguments)}},this._trackEvent=function(a,b,c,d){if(!angular.isUndefined(i.__gaTracker)){var e={eventCategory:a,eventAction:b};"undefined"!=typeof c&&(e.eventLabel=c),"undefined"!=typeof d&&(!isNaN(parseFloat(d))&&isFinite(d)&&(d=0),e.eventValue=d),i.__gaTracker("send","event",e);for(var f=1;f<this.trackers.length;f++)i.__gaTracker(this.trackers[f].name+".send","event",e);this._log("event",arguments)}},this._addImpression=function(a,b,c,d,e,f,g,h,j){if(!angular.isUndefined(i.__gaTracker)){this._loadEnhancedEcommerce();var k={id:a,name:b,category:c,brand:d,variant:e,list:f,position:g,dimension1:h,price:j};this.trackers[0].trackEnhancedEcommerce&&(i.__gaTracker("ec:addImpression",k),this._log("ec:addImpression",arguments));for(var l=1;l<this.trackers.length;l++)this.trackers[l].trackEnhancedEcommerce&&(i.__gaTracker(this.trackers[l].name+".ec:addImpression",k),this._log("ec:addImpression",arguments))}},this._addProduct=function(a,b,c,d,e,f,g,h,j,k){if(!angular.isUndefined(i.__gaTracker)){this._loadEnhancedEcommerce();var l={id:a,name:b,category:c,brand:d,variant:e,position:f,dimension1:g,price:h,quantity:j,coupon:k};this.trackers[0].trackEnhancedEcommerce&&(i.__gaTracker("ec:addProduct",l),this._log("ec:addProduct",arguments));for(var m=1;m<this.trackers.length;m++)this.trackers[m].trackEnhancedEcommerce&&(i.__gaTracker(this.trackers[m].name+".ec:addProduct",l),this._log("ec:addProduct",arguments))}},this._addPromo=function(a,b,c,d){if(!angular.isUndefined(i.__gaTracker)){this._loadEnhancedEcommerce();var e={id:a,name:b,creative:c,position:d};this.trackers[0].trackEnhancedEcommerce&&(i.__gaTracker("ec:addPromo",e),this._log("ec:addPromo",arguments));for(var f=1;f<this.trackers.length;f++)this.trackers[f].trackEnhancedEcommerce&&(i.__gaTracker(this.trackers[f].name+".ec:addPromo",e),this._log("ec:addPromo",arguments));this._setAction("promo_click"),this._trackEvent("Internal Promotions","click",b)}},this._setAction=function(a,b){if(!angular.isUndefined(i.__gaTracker)){this._loadEnhancedEcommerce(),this.trackers[0].trackEnhancedEcommerce&&(i.__gaTracker("ec:setAction",a,b),this._log("ec:setAction",arguments));for(var c=1;c<this.trackers.length;c++)this.trackers[c].trackEnhancedEcommerce&&(i.__gaTracker(this.trackers[c].name+".ec:setAction",a,b),this._log("ec:setAction",arguments))}},this._addTrans=function(a,b,c,d,e,f){if(!angular.isUndefined(i.__gaTracker)){this._loadEcommerce(),null==f&&(f="USD");var g={id:a,affiliation:b,revenue:c,shipping:e,tax:d,currency:f};this.trackers[0].trackEcommerce&&(i.__gaTracker("ecommerce:addTransaction",g),this._log("ecommerce:addTransaction",arguments));for(var h=1;h<this.trackers.length;h++)this.trackers[h].trackEcommerce&&(i.__gaTracker(this.trackers[h].name+".ecommerce:addTransaction",g),this._log("ecommerce:addTransaction",arguments))}},this._addItem=function(a,b,c,d,e,f,g){if(!angular.isUndefined(i.__gaTracker)){this._loadEcommerce(),null==g&&(g="USD");var h={id:a,name:b,sku:c,category:d,price:e,quantity:f,currency:g};this.trackers[0].trackEcommerce&&(i.__gaTracker("ecommerce:addItem",h),this._log("ecommerce:addItem",arguments));for(var j=1;j<this.trackers.length;j++)this.trackers[j].trackEcommerce&&(i.__gaTracker(this.trackers[j].name+".ecommerce:addItem",h),this._log("ecommerce:addItem",arguments))}},this._trackTrans=function(){if(!angular.isUndefined(i.__gaTracker)){this._loadEcommerce(),this.trackers[0].trackEcommerce&&(i.__gaTracker("ecommerce:send"),this._log("ecommerce:send",arguments));for(var a=1;a<this.trackers.length;a++)this.trackers[a].trackEcommerce&&(i.__gaTracker(this.trackers[a].name+".ecommerce:send"),this._log("ecommerce:send",arguments))}},this._clearTrans=function(){if(!angular.isUndefined(i.__gaTracker)){this._loadEcommerce(),this.trackers[0].trackEcommerce&&(i.__gaTracker("ecommerce:clear"),this._log("ecommerce:clear",arguments));for(var a=1;a<this.trackers.length;a++)this.trackers[a].trackEcommerce&&(i.__gaTracker(this.trackers[a].name+".ecommerce:clear"),this._log("ecommerce:clear",arguments))}},this._trackSocial=function(a,b,c){if(!angular.isUndefined(i.__gaTracker)){var d={socialNetwork:a,socialAction:b,socialTarget:c};i.__gaTracker("send","social",d);for(var e=1;e<this.trackers.length;e++)i.__gaTracker(this.trackers[e].name+".send","social",d);this._log("trackSocial",arguments)}},this._createScriptTag(),this._createPixelScriptTag();var j=this;return b&&g.$on(e,function(){j._trackPage(h.path(),g.pageTitle)}),{_logs:j._logs,trackers:j.trackers,trackPage:function(a,b){j._trackPage(a,b)},trackEvent:function(a,b,c,d){j._trackEvent(a,b,c,d)},addImpression:function(a,b,c,d,e,f,g,h,i){j._addImpression(a,b,c,d,e,f,g,h,i)},addProduct:function(a,b,c,d,e,f,g,h,i,k){j._addProduct(a,b,c,d,e,f,g,h,i,k)},addPromo:function(a,b,c,d){j._addPromo(a,b,c,d)},setAction:function(a,b){j._setAction(a,b)},addTrans:function(a,b,c,d,e){j._addTrans(a,b,c,d,e)},addItem:function(a,b,c,d,e,f){j._addItem(a,c,b,d,e,f)},trackTrans:function(){j._trackTrans()},clearTrans:function(){j._clearTrans()},trackSocial:function(a,b,c){j._trackSocial(a,b,c)},ga:function(){angular.isDefined(i.__gaTracker)&&i.__gaTracker(arguments)},trackPixelPage:function(){j._trackPixelPage()},trackPixelViewContent:function(a,b,c,d){angular.isUndefined(b)&&(b="USD"),angular.isUndefined(a)&&(a=0),angular.isUndefined(d)&&(d="product"),j._trackPixel("ViewContent",{value:a,currency:b,content_ids:c,content_type:d})},trackPixelSearch:function(a){j._trackPixel("Search",{search_string:a})},trackPixelAddToCart:function(a,b,c,d){angular.isUndefined(b)&&(b="USD"),angular.isUndefined(a)||(angular.isUndefined(d)&&(d="product"),j._trackPixel("AddToCart",{value:a,currency:b,content_ids:c,content_type:d}))},trackPixelAddToWishList:function(a,b){angular.isUndefined(b)&&(b="USD"),angular.isUndefined(a)||j._trackPixel("AddToWishList",{value:a,currency:b})},trackPixelInitiateCheckout:function(){j._trackPixel("InitiateCheckout")},trackPixelAddPaymentInfo:function(){j._trackPixel("AddPaymentInfo")},trackPixelPurchase:function(a,b,c,d){angular.isUndefined(b)&&(b="USD"),angular.isUndefined(a)||(angular.isUndefined(d)&&(d="product"),j._trackPixel("Purchase",{value:a,currency:b,content_type:d,content_ids:c}))},trackPixelLead:function(a,b){angular.isUndefined(b)&&(b="USD"),angular.isUndefined(a)||j._trackPixel("Lead",{value:a,currency:b})},trackPixelCompleteRegistration:function(a,b){angular.isUndefined(b)&&(b="USD"),angular.isUndefined(a)||j._trackPixel("CompleteRegistration",{value:a,currency:b})},trackPixelCustom:function(a,b){j._trackPixel(a,b)}}}]});